define("assignsubmission_cloudpoodll/drawing_board",["jquery"],(function($){var DrawingBoard=function(canvasid){this.canvas=document.getElementById(canvasid),this.ctx=this.canvas.getContext("2d"),this.width=this.canvas.width,this.height=this.canvas.height,this.drawing=!1,this.steps=[],this.redoStack=[],this.currentStep=null,this.tool="pencil",this.strokeColor="#000000",this.fillColor="#ffffff",this.bgColor="#ffffff",this.strokeSize=5,this.backimage=null,this.zoom=1,this.init()};return DrawingBoard.prototype.init=function(){var that=this;$(this.canvas).on("mousedown touchstart",(function(e){if("text"!==that.tool&&"stamp"!==that.tool){that.drawing=!0;var pos=that.getPos(e);that.currentStep={type:that.tool,points:[pos],strokeColor:that.strokeColor,fillColor:that.fillColor,strokeSize:that.strokeSize},that.redraw()}})),$(document).on("mousemove touchmove",(function(e){if(that.drawing){var pos=that.getPos(e);"pencil"===that.tool||"eraser"===that.tool||"highlighter"===that.tool?that.currentStep.points.push(pos):that.currentStep.points.length>1?that.currentStep.points[1]=pos:that.currentStep.points.push(pos),that.redraw(),e.preventDefault()}})),$(document).on("mouseup touchend",function(){that.drawing&&(that.drawing=!1,that.currentStep&&this.addStep(that.currentStep),that.currentStep=null,that.redraw())}.bind(this))},DrawingBoard.prototype.addStep=function(step){this.steps.push(step),this.redoStack=[],$(this.canvas).trigger("wb:changed")},DrawingBoard.prototype.undo=function(){this.steps.length>0&&(this.redoStack.push(this.steps.pop()),this.redraw(),$(this.canvas).trigger("wb:changed"))},DrawingBoard.prototype.redo=function(){this.redoStack.length>0&&(this.steps.push(this.redoStack.pop()),this.redraw(),$(this.canvas).trigger("wb:changed"))},DrawingBoard.prototype.getPos=function(e){var rect=this.canvas.getBoundingClientRect(),clientX=e.clientX||(e.originalEvent&&e.originalEvent.touches?e.originalEvent.touches[0].clientX:0),clientY=e.clientY||(e.originalEvent&&e.originalEvent.touches?e.originalEvent.touches[0].clientY:0);return{x:(clientX-rect.left)/this.zoom,y:(clientY-rect.top)/this.zoom}},DrawingBoard.prototype.redraw=function(){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.fillStyle=this.bgColor,this.ctx.fillRect(0,0,this.width,this.height),this.backimage&&this.ctx.drawImage(this.backimage,0,0,this.width,this.height),this.steps.forEach(function(step){this.drawStep(step)}.bind(this)),this.currentStep&&this.drawStep(this.currentStep)},DrawingBoard.prototype.drawStep=function(step){switch(this.ctx.lineJoin="round",this.ctx.lineCap="round",this.ctx.strokeStyle=step.strokeColor,this.ctx.fillStyle=step.fillColor,this.ctx.lineWidth=step.strokeSize,"eraser"===step.type&&(this.ctx.strokeStyle=this.bgColor),step.type){case"pencil":case"eraser":case"highlighter":this.ctx.beginPath(),this.ctx.moveTo(step.points[0].x,step.points[0].y),step.points.forEach(function(p){this.ctx.lineTo(p.x,p.y)}.bind(this)),"highlighter"===step.type?(this.ctx.globalAlpha=.5,this.ctx.stroke(),this.ctx.globalAlpha=1):this.ctx.stroke();break;case"line":if(step.points.length<2)return;this.ctx.beginPath(),this.ctx.moveTo(step.points[0].x,step.points[0].y),this.ctx.lineTo(step.points[1].x,step.points[1].y),this.ctx.stroke();break;case"rect":if(step.points.length<2)return;var x=Math.min(step.points[0].x,step.points[1].x),y=Math.min(step.points[0].y,step.points[1].y),w=Math.abs(step.points[1].x-step.points[0].x),h=Math.abs(step.points[1].y-step.points[0].y);this.ctx.fillRect(x,y,w,h),this.ctx.strokeRect(x,y,w,h);break;case"circle":if(step.points.length<2)return;var dx=step.points[1].x-step.points[0].x,dy=step.points[1].y-step.points[0].y,radius=Math.sqrt(dx*dx+dy*dy);this.ctx.beginPath(),this.ctx.arc(step.points[0].x,step.points[0].y,radius,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke();break;case"stamp":if(step.stamp&&step.paths&&step.paths[step.stamp]){this.ctx.save(),"transparent"!==step.strokeColor&&(this.ctx.fillStyle=step.strokeColor);var p=new Path2D(step.paths[step.stamp]),cx=(x=step.points[0].x,y=step.points[0].y,x+step.width/2),cy=y+step.height/2;this.ctx.translate(cx,cy);var scaleX=step.width/512,scaleY=step.height/512;this.ctx.scale(scaleX,scaleY),this.ctx.translate(-256,-256),"transparent"!==step.strokeColor&&this.ctx.fill(p),this.ctx.restore()}break;case"text":if(step.text){var fontStyle=step.isItalic?"italic ":"",fontWeight=step.isBold?"bold ":"",fontSize=step.fontSize||5*step.strokeSize,fontFamily=step.fontFamily||"Arial";this.ctx.font=fontStyle+fontWeight+fontSize+"px "+fontFamily,this.ctx.textBaseline="top",this.ctx.fillStyle=step.strokeColor;for(var maxWidth=step.width||9999,paragraphs=step.text.split("\n"),lineHeight=1.2*fontSize,startX=step.points[0].x+4,i=(y=step.points[0].y+4,0);i<paragraphs.length;i++){for(var words=paragraphs[i].split(" "),line="",n=0;n<words.length;n++){var testLine=line+words[n]+" ";this.ctx.measureText(testLine).width>maxWidth&&n>0?(this.ctx.fillText(line,startX,y),line=words[n]+" ",y+=lineHeight):line=testLine}this.ctx.fillText(line,startX,y),y+=lineHeight}}}},DrawingBoard.prototype.clear=function(){this.addStep({type:"clear",bgColor:this.bgColor}),this.steps=[],this.redraw()},DrawingBoard.prototype.setBackImage=function(url){var img=new Image;img.onload=function(){this.backimage=img;var aspect=img.width/img.height,newHeight=this.width/aspect;this.height=newHeight,this.canvas.height=newHeight,this.redraw(),$(this.canvas).trigger("wb:resized",[{width:this.width,height:this.height}])}.bind(this),img.src=url},DrawingBoard.prototype.setVectorData=function(steps){this.steps=steps,this.redraw()},DrawingBoard.prototype.getVectorData=function(){return JSON.stringify(this.steps)},DrawingBoard.prototype.getImageData=function(){return this.canvas.toDataURL("image/jpeg",.8)},DrawingBoard.prototype.loadVectorData=function(json){try{this.steps=JSON.parse(json),this.redraw()}catch(e){console.error("Error loading vector data",e)}},DrawingBoard}));

//# sourceMappingURL=drawing_board.min.js.map