{"version":3,"file":"standardtranscript.min.js","sources":["../src/standardtranscript.js"],"sourcesContent":["define(['jquery', 'core/log', 'core/str', 'core/ajax', 'core/notification', './copy_to_clipboard'],\n    function ($, log, str, Ajax, notification) {\n        \"use strict\"; // jshint ;_;\n\n        log.debug('Standard Transcript: initialising');\n\n        return {\n\n            init: function (opts) {\n\n                var component = opts['component'];\n                var playerid = opts['playerid'];\n                var containerid = opts['containerid'];\n                var cssprefix = opts['cssprefix'];\n                var config = {};\n                config.settings = {};\n                if (playerid && $('#' + playerid).length) {\n                    config.component = component;\n                    config.container = $('#' + containerid);\n                    config.prefix = cssprefix;\n                    config.player = $('#' + playerid)[0];\n                    config.transcripturl = opts['transcripturl'];\n                    config.title = M.util.get_string('transcripttitle', component);\n                    config.assignmentid = opts['assignmentid'];\n                    this.fetch_transcript(config);\n                }\n            },\n\n\n\n            fetch_transcript: function (config) {\n                var that = this;\n                var header = '<header class=\"' + config.prefix + '-header\">' + config.title + '</header>';\n                var textcontainer = $('<p id=\"' + config.prefix + '-text\" class=\"' + config.prefix + '-text\"></p>');\n\n                textcontainer.load(config.transcripturl, function () {\n                    config.transcripttext = textcontainer.text();\n                    config.container.prepend(header);\n                    config.container.append(textcontainer);\n\n                    that.prepare_copy_button(config.prefix + '-text');\n                    that.prepare_corrections_button(config);\n\n\n                });\n            },\n\n            prepare_copy_button: function (target) {\n                return '<a href=\"javascript:void()\" data-action=\"copy\" data-clipboard-target=\"#' +\n                    target + '\"><i class=\"fa fa-copy\"></i></a>';\n            },\n\n            prepare_corrections_button: function (config) {\n                var that = this;\n\n                var onetimeloaded = false;\n                // config.button =  config.container.append(button);\n\n                $(config.container).on('click', '[data-action=\"getcorrection\"]', function (e) {\n                    e.preventDefault();\n                    if (!onetimeloaded) {\n                        that.fetch_corrections(config);\n                        onetimeloaded = true;\n                    }\n                });\n                var button = '<a href=\"javascript:void()\" data-action=\"getcorrection\"><i class=\"fa fa-check\"></a>';\n                return button;\n            },\n\n            fetch_corrections: function (config) {\n                var that = this;\n                //do the check\n                var text = config.transcripttext;\n                //but quit if its empty\n                if (!text || text === '' || text.trim() === '') {\n                    return;\n                }\n                config.correctionscontainer = $('<code class=\"' + config.prefix + '-difftext\"></code>').appendTo(config.container);\n\n                Ajax.call([{\n                    methodname: 'assignsubmission_cloudpoodll_check_grammar',\n                    args: {\n                        assignmentid: config.assignmentid,\n                        text: text\n\n                    },\n                    done: function (ajaxresult) {\n                        var payloadobject = JSON.parse(ajaxresult);\n                        if (payloadobject) {\n                            config.correctionscontainer.html(payloadobject.diffhtml);\n                            config.correctionscontainer.append('<textarea style=\"display: none\" id =\"' + config.prefix + '-difftext\">' +\n                                payloadobject.corrections + '</textarea>');\n                            var copybutton = that.prepare_copy_button(config.prefix + '-difftext');\n\n                            config.correctionscontainer.append('<div class=\"assignsubmission_cloudpoodll_actionbar\">' +\n                                copybutton + '</div>');\n                        } else {\n                            //something went wrong\n                            config.textcontainer.html('could not fetch corrections');\n                            log.debug('result not fetched');\n                        }\n\n                    },\n                    fail: notification.exception\n                }]);\n            }\n\n        };//end of return object\n    });"],"names":["define","$","log","str","Ajax","notification","debug","init","opts","component","playerid","containerid","cssprefix","config","length","container","prefix","player","transcripturl","title","M","util","get_string","assignmentid","fetch_transcript","that","this","header","textcontainer","load","transcripttext","text","prepend","append","prepare_copy_button","prepare_corrections_button","target","onetimeloaded","on","e","preventDefault","fetch_corrections","trim","correctionscontainer","appendTo","call","methodname","args","done","ajaxresult","payloadobject","JSON","parse","html","diffhtml","corrections","copybutton","fail","exception"],"mappings":"AAAAA,yDAAO,CAAC,SAAU,WAAY,WAAY,YAAa,oBAAqB,wBACxE,SAAUC,EAAGC,IAAKC,IAAKC,KAAMC,qBAGzBH,IAAII,MAAM,qCAEH,CAEHC,KAAM,SAAUC,UAERC,UAAYD,KAAI,UAChBE,SAAWF,KAAI,SACfG,YAAcH,KAAI,YAClBI,UAAYJ,KAAI,UAChBK,OAAS,CACbA,SAAkB,IACdH,UAAYT,EAAE,IAAMS,UAAUI,SAC9BD,OAAOJ,UAAYA,UACnBI,OAAOE,UAAYd,EAAE,IAAMU,aAC3BE,OAAOG,OAASJ,UAChBC,OAAOI,OAAShB,EAAE,IAAMS,UAAU,GAClCG,OAAOK,cAAgBV,KAAI,cAC3BK,OAAOM,MAAQC,EAAEC,KAAKC,WAAW,kBAAmBb,WACpDI,OAAOU,aAAef,KAAI,kBACrBgB,iBAAiBX,UAM9BW,iBAAkB,SAAUX,YACpBY,KAAOC,KACPC,OAAS,kBAAoBd,OAAOG,OAAS,YAAcH,OAAOM,MAAQ,YAC1ES,cAAgB3B,EAAE,UAAYY,OAAOG,OAAS,iBAAmBH,OAAOG,OAAS,eAErFY,cAAcC,KAAKhB,OAAOK,eAAe,WACrCL,OAAOiB,eAAiBF,cAAcG,OACtClB,OAAOE,UAAUiB,QAAQL,QACzBd,OAAOE,UAAUkB,OAAOL,eAExBH,KAAKS,oBAAoBrB,OAAOG,OAAS,SACzCS,KAAKU,2BAA2BtB,YAMxCqB,oBAAqB,SAAUE,cACpB,0EACHA,OAAS,oCAGjBD,2BAA4B,SAAUtB,YAC9BY,KAAOC,KAEPW,eAAgB,EAGpBpC,EAAEY,OAAOE,WAAWuB,GAAG,QAAS,iCAAiC,SAAUC,GACvEA,EAAEC,iBACGH,gBACDZ,KAAKgB,kBAAkB5B,QACvBwB,eAAgB,YAGX,uFAIjBI,kBAAmB,SAAU5B,YACrBY,KAAOC,KAEPK,KAAOlB,OAAOiB,eAEbC,MAAiB,KAATA,MAA+B,KAAhBA,KAAKW,SAGjC7B,OAAO8B,qBAAuB1C,EAAE,gBAAkBY,OAAOG,OAAS,sBAAsB4B,SAAS/B,OAAOE,WAExGX,KAAKyC,KAAK,CAAC,CACPC,WAAY,6CACZC,KAAM,CACFxB,aAAcV,OAAOU,aACrBQ,KAAMA,MAGViB,KAAM,SAAUC,gBACRC,cAAgBC,KAAKC,MAAMH,eAC3BC,cAAe,CACfrC,OAAO8B,qBAAqBU,KAAKH,cAAcI,UAC/CzC,OAAO8B,qBAAqBV,OAAO,wCAA0CpB,OAAOG,OAAS,cACzFkC,cAAcK,YAAc,mBAC5BC,WAAa/B,KAAKS,oBAAoBrB,OAAOG,OAAS,aAE1DH,OAAO8B,qBAAqBV,OAAO,uDAC/BuB,WAAa,eAGjB3C,OAAOe,cAAcyB,KAAK,+BAC1BnD,IAAII,MAAM,uBAIlBmD,KAAMpD,aAAaqD"}