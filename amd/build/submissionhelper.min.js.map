{"version":3,"file":"submissionhelper.min.js","sources":["../src/submissionhelper.js"],"sourcesContent":["define(['jquery', 'core/log', 'assignsubmission_cloudpoodll/cloudpoodllloader', \"core/str\"], function ($, log, cloudpoodll, str) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug('submission helper: initialising');\n\n    return {\n\n        uploadstate: false,\n        togglestate: 0,\n        strings: {},\n\n\n        init: function (opts) {\n            this.component = opts['component'];\n            this.safesave = opts['safesave'];\n            this.recordertype = opts['recordertype'];\n\n            this.register_controls();\n            this.register_events();\n            if (this.recordertype !== 'whiteboard') {\n                this.setup_recorder();\n            }\n        },\n\n        setup_recorder: function () {\n            var that = this;\n            var recorder_callback = function (evt) {\n                switch (evt.type) {\n                    case 'recording':\n                        if (evt.action === 'started') {\n                            that.controls.updatecontrol.val();\n                            //if opts safe save\n                            if (that.safesave == 1) {\n                                that.controls.formsubmitbutton.attr('disabled', 'disabled');\n                            }\n                        }\n                        break;\n                    case 'awaitingprocessing':\n                        if (that.uploadstate != 'posted') {\n                            that.controls.updatecontrol.val(evt.mediaurl);\n                            //if opts safe save\n                            if (that.safesave == 1) {\n                                that.controls.formsubmitbutton.removeAttr('disabled', 'disabled');\n                            }\n                        }\n                        that.uploadstate = 'posted';\n                        break;\n                    case 'error':\n                        alert('PROBLEM:' + evt.message);\n                        break;\n                }\n            };\n            cloudpoodll.init(this.component + '_therecorder', recorder_callback);\n        },\n\n\n        register_controls: function () {\n            var that = this;\n            this.controls = {};\n            this.controls.formsubmitbutton = $('#id_submitbutton');\n            this.controls.deletebutton = $('.' + this.component + '_deletesubmissionbutton');\n            this.controls.updatecontrol = $('#' + this.component + '_updatecontrol');\n            this.controls.currentcontainer = $('.' + this.component + '_currentsubmission');\n            this.controls.togglecontainer = $('.' + this.component + '_togglecontainer');\n            this.controls.togglebutton = $('.' + this.component + '_togglecontainer .togglebutton');\n            this.controls.toggletext = $('.' + this.component + '_togglecontainer .toggletext');\n            str.get_string('clicktohide', that.component).done(function (s) {\n                that.strings['clicktohide'] = s;\n            });\n            str.get_string('clicktoshow', that.component).done(function (s) {\n                that.strings['clicktoshow'] = s;\n            });\n        },\n\n        register_events: function () {\n            var that = this;\n            this.controls.deletebutton.click(function () {\n                if (that.controls.updatecontrol) {\n                    if (confirm(M.util.get_string('reallydeletesubmission', that.component))) {\n                        that.controls.updatecontrol.val(-1);\n                        that.controls.currentcontainer.html('');\n                    }\n                }\n            });\n            this.controls.togglebutton.click(function () { that.toggle_currentsubmission(that); });\n            this.controls.toggletext.click(function () { that.toggle_currentsubmission(that); });\n        },\n\n        toggle_currentsubmission: function (that) {\n            var doToggleState = function () {\n                if (that.togglestate == 0) {\n                    that.controls.togglebutton.removeClass('fa-toggle-off');\n                    that.controls.togglebutton.addClass('fa-toggle-on');\n                    that.controls.toggletext.text(that.strings['clicktohide']);\n                    that.togglestate = 1;\n                } else {\n                    that.controls.togglebutton.removeClass('fa-toggle-on');\n                    that.controls.togglebutton.addClass('fa-toggle-off');\n                    that.controls.toggletext.text(that.strings['clicktoshow']);\n                    that.togglestate = 0;\n                }\n            };\n            that.controls.currentcontainer.toggle(\n                { duration: 300, complete: doToggleState }\n            );\n            return false;\n        }\n    };//end of return object\n});"],"names":["define","$","log","cloudpoodll","str","debug","uploadstate","togglestate","strings","init","opts","component","safesave","recordertype","register_controls","register_events","this","setup_recorder","that","evt","type","action","controls","updatecontrol","val","formsubmitbutton","attr","mediaurl","removeAttr","alert","message","deletebutton","currentcontainer","togglecontainer","togglebutton","toggletext","get_string","done","s","click","confirm","M","util","html","toggle_currentsubmission","toggle","duration","complete","removeClass","addClass","text"],"mappings":"AAAAA,uDAAO,CAAC,SAAU,WAAY,iDAAkD,aAAa,SAAUC,EAAGC,IAAKC,YAAaC,YAGxHF,IAAIG,MAAM,mCAEH,CAEHC,aAAa,EACbC,YAAa,EACbC,QAAS,GAGTC,KAAM,SAAUC,WACPC,UAAYD,KAAI,eAChBE,SAAWF,KAAI,cACfG,aAAeH,KAAI,kBAEnBI,yBACAC,kBACqB,eAAtBC,KAAKH,mBACAI,kBAIbA,eAAgB,eACRC,KAAOF,KA2BXb,YAAYM,KAAKO,KAAKL,UAAY,gBA1BV,SAAUQ,YACtBA,IAAIC,UACH,YACkB,YAAfD,IAAIE,SACJH,KAAKI,SAASC,cAAcC,MAEP,GAAjBN,KAAKN,UACLM,KAAKI,SAASG,iBAAiBC,KAAK,WAAY,uBAIvD,qBACuB,UAApBR,KAAKZ,cACLY,KAAKI,SAASC,cAAcC,IAAIL,IAAIQ,UAEf,GAAjBT,KAAKN,UACLM,KAAKI,SAASG,iBAAiBG,WAAW,WAAY,aAG9DV,KAAKZ,YAAc,mBAElB,QACDuB,MAAM,WAAaV,IAAIW,cAQvChB,kBAAmB,eACXI,KAAOF,UACNM,SAAW,QACXA,SAASG,iBAAmBxB,EAAE,yBAC9BqB,SAASS,aAAe9B,EAAE,IAAMe,KAAKL,UAAY,gCACjDW,SAASC,cAAgBtB,EAAE,IAAMe,KAAKL,UAAY,uBAClDW,SAASU,iBAAmB/B,EAAE,IAAMe,KAAKL,UAAY,2BACrDW,SAASW,gBAAkBhC,EAAE,IAAMe,KAAKL,UAAY,yBACpDW,SAASY,aAAejC,EAAE,IAAMe,KAAKL,UAAY,uCACjDW,SAASa,WAAalC,EAAE,IAAMe,KAAKL,UAAY,gCACpDP,IAAIgC,WAAW,cAAelB,KAAKP,WAAW0B,MAAK,SAAUC,GACzDpB,KAAKV,QAAL,YAA8B8B,KAElClC,IAAIgC,WAAW,cAAelB,KAAKP,WAAW0B,MAAK,SAAUC,GACzDpB,KAAKV,QAAL,YAA8B8B,MAItCvB,gBAAiB,eACTG,KAAOF,UACNM,SAASS,aAAaQ,OAAM,WACzBrB,KAAKI,SAASC,eACViB,QAAQC,EAAEC,KAAKN,WAAW,yBAA0BlB,KAAKP,cACzDO,KAAKI,SAASC,cAAcC,KAAK,GACjCN,KAAKI,SAASU,iBAAiBW,KAAK,aAI3CrB,SAASY,aAAaK,OAAM,WAAcrB,KAAK0B,yBAAyB1B,cACxEI,SAASa,WAAWI,OAAM,WAAcrB,KAAK0B,yBAAyB1B,UAG/E0B,yBAA0B,SAAU1B,aAchCA,KAAKI,SAASU,iBAAiBa,OAC3B,CAAEC,SAAU,IAAKC,SAdD,WACQ,GAApB7B,KAAKX,aACLW,KAAKI,SAASY,aAAac,YAAY,iBACvC9B,KAAKI,SAASY,aAAae,SAAS,gBACpC/B,KAAKI,SAASa,WAAWe,KAAKhC,KAAKV,QAAL,aAC9BU,KAAKX,YAAc,IAEnBW,KAAKI,SAASY,aAAac,YAAY,gBACvC9B,KAAKI,SAASY,aAAae,SAAS,iBACpC/B,KAAKI,SAASa,WAAWe,KAAKhC,KAAKV,QAAL,aAC9BU,KAAKX,YAAc,OAMpB"}