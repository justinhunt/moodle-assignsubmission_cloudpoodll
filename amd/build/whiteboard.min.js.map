{"version":3,"file":"whiteboard.min.js","sources":["../src/whiteboard.js"],"sourcesContent":["define(['jquery', 'core/log', 'core/ajax', 'core/notification', 'core/str', 'assignsubmission_cloudpoodll/drawing_board'],\n    function ($, log, Ajax, Notification, Str, DrawingBoard) {\n        \"use strict\";\n\n        return {\n\n            strings: {},\n\n            init: function (uniqueid) {\n                var container = $('#' + uniqueid);\n                var canvasid = uniqueid + '_canvas';\n                var board = new DrawingBoard(canvasid);\n                this.setup_strings(container);\n                this.setup_controls(container, board);\n            },\n\n            setup_strings: function () {\n                var self = this;\n                // Set up strings\n                Str.get_strings([\n                    { \"key\": \"save\", \"component\": \"assignsubmission_cloudpoodll\" },\n                    { \"key\": \"saving\", \"component\": \"assignsubmission_cloudpoodll\" },\n                    { \"key\": \"saved\", \"component\": \"assignsubmission_cloudpoodll\" },\n                    { \"key\": \"confirmclearcanvas\", \"component\": \"assignsubmission_cloudpoodll\" },\n                    { \"key\": \"enterthetext\", \"component\": \"assignsubmission_cloudpoodll\" },\n                ]).done(function (s) {\n                    var i = 0;\n                    self.strings.save = s[i++];\n                    self.strings.saving = s[i++];\n                    self.strings.saved = s[i++];\n                    self.strings.confirmclearcanvas = s[i++];\n                    self.strings.enterthetext = s[i++];\n                });\n            },\n\n            setup_controls: function (container, board) {\n                var self = this;\n\n                // Set background image if provided\n                var backimage = container.data('backimage');\n                if (backimage) {\n                    board.setBackImage(backimage);\n                }\n\n                // Set vector data if provided\n                var vdata = container.data('vdata');\n                if (vdata) {\n                    board.setVectorData(vdata);\n                }\n\n\n                // --- Tool Selection ---\n                container.find('.wb-tool').click(function () {\n                    var tool = $(this).data('tool');\n                    board.tool = tool;\n                    container.find('.wb-tool').removeClass('active');\n                    $(this).addClass('active');\n\n                    // Toggle top bar panels\n                    if (tool === 'text') {\n                        container.find('.wb-stroke-sizes').hide();\n                        container.find('.wb-stamp-settings').hide();\n                        container.find('.wb-text-settings').show();\n                    } else if (tool === 'stamp') {\n                        container.find('.wb-stroke-sizes').hide();\n                        container.find('.wb-text-settings').hide();\n                        container.find('.wb-stamp-settings').css('display', 'flex');\n                    } else {\n                        container.find('.wb-text-settings').hide();\n                        container.find('.wb-stamp-settings').hide();\n                        container.find('.wb-stroke-sizes').show();\n                    }\n                });\n\n                // --- Stroke Size ---\n                container.find('.wb-size').click(function () {\n                    var size = $(this).data('size');\n                    board.strokeSize = size;\n                    container.find('.wb-size').removeClass('active');\n                    $(this).addClass('active');\n                });\n\n                // --- Stamp Selection & Paths ---\n                var stampPaths = {\n                    'check-circle': 'M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628 0z',\n                    'times-circle': 'M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z',\n                    'exclamation-triangle': 'M506.3 417l-213.3-364c-16.33-28-57.54-28-73.98 0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6C502.1 480 522.6 445 506.3 417zM232 168c0-8.836 7.164-16 16-16h16c8.836 0 16 7.164 16 16v148c0 8.836-7.164 16-16 16h-16c-8.836 0-16-7.164-16-16V168zm24 272c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32z',\n                    'lightbulb': 'M355.2 331.1C339.4 345.2 320 357.7 320 384h-128c0-26.3-19.4-38.8-35.2-52.9C119.8 298.5 96 261 96 216c0-88.4 71.6-160 160-160s160 71.6 160 160c0 45-23.8 82.5-60.8 115.1zM256 512c26.5 0 48-21.5 48-48h-96c0 26.5 21.5 48 48 48zm64-112h-128c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h128c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16z',\n                    'heart': 'M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z'\n                };\n\n                var activeStamp = 'check-circle';\n                container.find('.wb-stamp-pick').click(function () {\n                    activeStamp = $(this).data('stamp');\n                    container.find('.wb-stamp-pick').removeClass('active');\n                    $(this).addClass('active');\n                    if ($activeStampBox) {\n                        updateStampSVG();\n                    }\n                });\n\n                // --- Color Pickers ---\n                container.find('.wb-color-box').click(function () {\n                    $(this).siblings('.wb-color-picker').click();\n                });\n\n                // --- Transparent options ---\n                container.find('.wb-stroke-clear').click(function () {\n                    board.strokeColor = 'transparent';\n                    container.find('.wb-stroke-color').css('background-color', 'transparent');\n                });\n\n                container.find('.wb-fill-clear').click(function () {\n                    board.fillColor = 'transparent';\n                    container.find('.wb-fill-color').css('background-color', 'transparent');\n                });\n\n                container.find('.wb-bg-clear').click(function () {\n                    board.bgColor = 'transparent';\n                    container.find('.wb-bg-color').css('background-color', 'transparent');\n                    board.redraw();\n                });\n\n                container.find('.wb-stroke-picker').on('input change', function () {\n                    var color = $(this).val();\n                    board.strokeColor = color;\n                    container.find('.wb-stroke-color').css('background-color', color);\n                });\n\n                container.find('.wb-fill-picker').on('input change', function () {\n                    var color = $(this).val();\n                    board.fillColor = color;\n                    container.find('.wb-fill-color').css('background-color', color);\n                });\n\n                container.find('.wb-bg-picker').on('input change', function () {\n                    var color = $(this).val();\n                    board.bgColor = color;\n                    container.find('.wb-bg-color').css('background-color', color);\n                    board.redraw();\n                });\n\n                // --- Sidebar Toggle ---\n                container.find('.wb-sidebar-toggle').click(function () {\n                    container.find('.wb-sidebar').toggleClass('collapsed');\n                });\n\n                // --- Actions ---\n                container.find('.undo-whiteboard').click(function () { board.undo(); });\n                container.find('.redo-whiteboard').click(function () { board.redo(); });\n                container.find('.clear-whiteboard').click(function () {\n                    if (confirm(self.strings.confirmclearcanvas)) {\n                        board.clear();\n                    }\n                });\n\n                var baseWidth = container.data('width') || 800;\n                var baseHeight = container.data('height') || 600;\n\n                $(board.canvas).on('wb:resized', function (e, dims) {\n                    baseWidth = dims.width;\n                    baseHeight = dims.height;\n                    updateZoom();\n                });\n\n                var updateZoom = function () {\n                    var $canvas = $(board.canvas);\n                    $canvas.css({\n                        'transform': 'scale(' + board.zoom + ')',\n                        'transform-origin': '0 0'\n                    });\n                    var $wb = container.find('.assignsubmission_cloudpoodll_whiteboard');\n                    $wb.css({\n                        'width': (baseWidth * board.zoom) + 'px',\n                        'height': (baseHeight * board.zoom) + 'px'\n                    });\n                };\n\n                container.find('.zoom-in').click(function () {\n                    board.zoom += 0.1;\n                    updateZoom();\n                });\n                container.find('.zoom-out').click(function () {\n                    if (board.zoom > 0.5) {\n                        board.zoom -= 0.1;\n                        updateZoom();\n                    }\n                });\n\n                // --- Interactive Text Tool ---\n                var $activeTextBox = null;\n\n                var commitText = function () {\n                    if (!$activeTextBox) return;\n                    var $textarea = $activeTextBox.find('textarea');\n                    var text = $textarea.val();\n                    if (text.trim() !== '') {\n                        var pos = $activeTextBox.position();\n                        // Adjust position based on zoom\n                        var x = pos.left / board.zoom;\n                        var y = pos.top / board.zoom;\n\n                        var step = {\n                            type: 'text',\n                            text: text,\n                            points: [{ x: x, y: y }],\n                            width: Math.max(10, ($activeTextBox.width() - 8) / board.zoom), // -8px for padding match\n                            strokeColor: board.strokeColor,\n                            fillColor: board.fillColor,\n                            strokeSize: board.strokeSize,\n                            fontFamily: container.find('.wb-text-font').val(),\n                            fontSize: parseInt(container.find('.wb-text-size').val()),\n                            isBold: container.find('.wb-text-bold').is(':checked'),\n                            isItalic: container.find('.wb-text-italic').is(':checked')\n                        };\n                        board.addStep(step);\n                        board.redraw();\n                    }\n                    $activeTextBox.remove();\n                    $activeTextBox = null;\n                };\n\n                var createTextBox = function (x, y) {\n                    commitText(); // Commit any existing one\n\n                    var $overlay = $('<div class=\"wb-text-overlay editing\"></div>');\n                    var $textarea = $('<textarea spellcheck=\"false\"></textarea>');\n\n                    // Apply current styles\n                    var updateStyles = function () {\n                        var fontFamily = container.find('.wb-text-font').val();\n                        var fontSize = container.find('.wb-text-size').val() + 'px';\n                        var isBold = container.find('.wb-text-bold').is(':checked');\n                        var isItalic = container.find('.wb-text-italic').is(':checked');\n\n                        $textarea.css({\n                            'font-family': fontFamily,\n                            'font-size': fontSize,\n                            'font-weight': isBold ? 'bold' : 'normal',\n                            'font-style': isItalic ? 'italic' : 'normal',\n                            'color': board.strokeColor\n                        });\n                    };\n\n                    updateStyles();\n\n                    // Listeners for live styling updates\n                    container.find('.wb-text-settings input, .wb-text-settings select, .wb-stroke-picker').off('change.wblive').on('change.wblive', updateStyles);\n\n                    $overlay.append($textarea);\n\n                    // Position it taking zoom into account\n                    $overlay.css({\n                        left: x * board.zoom,\n                        top: y * board.zoom\n                    });\n\n                    // Interaction logic\n                    var isDragging = false;\n                    var dragStartX, dragStartY, initialLeft, initialTop;\n\n                    $overlay.on('mousedown touchstart', function (e) {\n                        if ($overlay.hasClass('selected')) {\n                            isDragging = true;\n                            var touch = e.originalEvent.touches ? e.originalEvent.touches[0] : e;\n                            dragStartX = touch.pageX;\n                            dragStartY = touch.pageY;\n                            var pos = $overlay.position();\n                            initialLeft = pos.left;\n                            initialTop = pos.top;\n                            e.stopPropagation(); // Prevent board from drawing\n                        }\n                    });\n\n                    $(document).on('mousemove.wbtextdrag touchmove.wbtextdrag', function (e) {\n                        if (isDragging) {\n                            var touch = e.originalEvent.touches ? e.originalEvent.touches[0] : e;\n                            var dx = touch.pageX - dragStartX;\n                            var dy = touch.pageY - dragStartY;\n                            var newLeft = initialLeft + dx;\n                            var newTop = initialTop + dy;\n\n                            // Constrain to canvas\n                            var maxLeft = board.canvas.width * board.zoom - $overlay.outerWidth();\n                            var maxTop = board.canvas.height * board.zoom - $overlay.outerHeight();\n\n                            newLeft = Math.max(0, Math.min(newLeft, maxLeft));\n                            newTop = Math.max(0, Math.min(newTop, maxTop));\n\n                            $overlay.css({\n                                left: newLeft,\n                                top: newTop\n                            });\n                        }\n                    });\n\n                    $(document).on('mouseup.wbtextdrag touchend.wbtextdrag', function (e) {\n                        isDragging = false;\n                    });\n\n                    // Switch to selected mode on blur\n                    $textarea.on('blur', function () {\n                        $overlay.removeClass('editing').addClass('selected');\n                    });\n\n                    // Switch back to editing on double click or if it's selected and clicked\n                    $overlay.on('click', function (e) {\n                        if ($overlay.hasClass('selected')) {\n                            $overlay.removeClass('selected').addClass('editing');\n                            $textarea.focus();\n                            e.stopPropagation();\n                        }\n                    });\n\n                    container.find('.assignsubmission_cloudpoodll_whiteboard').append($overlay);\n                    $textarea.focus();\n                    $activeTextBox = $overlay;\n                };\n\n                // --- Interactive Stamp Tool ---\n                var $activeStampBox = null;\n\n                var commitStamp = function () {\n                    if (!$activeStampBox) return;\n                    var pos = $activeStampBox.position();\n                    // Adjust position and size based on zoom\n                    var x = pos.left / board.zoom;\n                    var y = pos.top / board.zoom;\n                    var width = $activeStampBox.width() / board.zoom;\n                    var height = $activeStampBox.height() / board.zoom;\n\n                    var step = {\n                        type: 'stamp',\n                        stamp: $activeStampBox.data('stamp'),\n                        paths: stampPaths,\n                        points: [{ x: x, y: y }],\n                        width: width,\n                        height: height,\n                        strokeColor: board.strokeColor\n                    };\n                    board.addStep(step);\n                    board.redraw();\n\n                    $activeStampBox.remove();\n                    $activeStampBox = null;\n                };\n\n                var updateStampSVG = function () {\n                    if (!$activeStampBox) return;\n                    activeStamp = container.find('.wb-stamp-pick.active').data('stamp');\n                    $activeStampBox.data('stamp', activeStamp);\n                    $activeStampBox.find('path').attr('d', stampPaths[activeStamp]);\n                    $activeStampBox.find('path').attr('fill', board.strokeColor);\n                };\n\n                // Listeners for live styling updates\n                container.find('.wb-stroke-picker').on('input change', function () {\n                    updateStampSVG();\n                });\n                container.find('.wb-stroke-clear').click(function () {\n                    setTimeout(updateStampSVG, 10);\n                });\n\n                var createStampBox = function (x, y) {\n                    commitStamp(); // Commit any existing one\n\n                    activeStamp = container.find('.wb-stamp-pick.active').data('stamp');\n\n                    var $overlay = $('<div class=\"wb-stamp-overlay\"></div>');\n                    var $svg = $('<svg viewBox=\"0 0 512 512\"><path d=\"' + stampPaths[activeStamp] + '\" fill=\"' + board.strokeColor + '\"/></svg>');\n                    var $resizeHandle = $('<div class=\"wb-stamp-resize\"></div>');\n\n                    $overlay.data('stamp', activeStamp);\n                    $overlay.append($svg).append($resizeHandle);\n\n                    // Initial size\n                    var size = 100;\n                    $overlay.css({\n                        left: x * board.zoom - (size * board.zoom) / 2,\n                        top: y * board.zoom - (size * board.zoom) / 2,\n                        width: size * board.zoom,\n                        height: size * board.zoom\n                    });\n\n                    // Interaction logic\n                    var isDragging = false, isResizing = false;\n                    var dragStartX, dragStartY, initialLeft, initialTop, initialWidth, initialHeight;\n\n                    $overlay.on('mousedown touchstart', function (e) {\n                        var target = $(e.target);\n                        var touch = e.originalEvent.touches ? e.originalEvent.touches[0] : e;\n                        dragStartX = touch.pageX;\n                        dragStartY = touch.pageY;\n                        var pos = $overlay.position();\n                        initialLeft = pos.left;\n                        initialTop = pos.top;\n                        initialWidth = $overlay.width();\n                        initialHeight = $overlay.height();\n\n                        if (target.hasClass('wb-stamp-resize')) {\n                            isResizing = true;\n                        } else {\n                            isDragging = true;\n                        }\n                        e.stopPropagation(); // Prevent board from drawing\n                        e.preventDefault();\n                    });\n\n                    $(document).on('mousemove.wbstampdrag touchmove.wbstampdrag', function (e) {\n                        if (!isDragging && !isResizing) return;\n                        var touch = e.originalEvent.touches ? e.originalEvent.touches[0] : e;\n\n                        if (isDragging) {\n                            var dx = touch.pageX - dragStartX;\n                            var dy = touch.pageY - dragStartY;\n                            $overlay.css({ left: initialLeft + dx, top: initialTop + dy });\n                        } else if (isResizing) {\n                            var dx = touch.pageX - dragStartX;\n                            var newSize = Math.max(20 * board.zoom, initialWidth + dx);\n                            $overlay.css({\n                                width: newSize,\n                                height: newSize\n                            });\n                        }\n                    });\n\n                    $(document).on('mouseup.wbstampdrag touchend.wbstampdrag', function (e) {\n                        isDragging = false;\n                        isResizing = false;\n                    });\n\n                    container.find('.assignsubmission_cloudpoodll_whiteboard').append($overlay);\n                    $activeStampBox = $overlay;\n                };\n\n                $(board.canvas).on('mousedown touchstart', function (e) {\n                    var rect = board.canvas.getBoundingClientRect();\n                    var touch = e.originalEvent.touches ? e.originalEvent.touches[0] : e;\n                    var clientX = touch.clientX;\n                    var clientY = touch.clientY;\n\n                    var isInside = (clientX >= rect.left && clientX <= rect.right && clientY >= rect.top && clientY <= rect.bottom);\n\n                    if (board.tool === 'text') {\n                        commitStamp();\n                        if ($activeTextBox && $activeTextBox.hasClass('selected')) {\n                            commitText();\n                        } else if (!$activeTextBox && isInside) {\n                            var x = (clientX - rect.left) / board.zoom;\n                            var y = (clientY - rect.top) / board.zoom;\n                            createTextBox(x, y);\n                        }\n                    } else if (board.tool === 'stamp') {\n                        commitText();\n                        if ($activeStampBox) {\n                            commitStamp();\n                        } else if (isInside) {\n                            var x = (clientX - rect.left) / board.zoom;\n                            var y = (clientY - rect.top) / board.zoom;\n                            createStampBox(x, y);\n                        }\n                    } else {\n                        commitText();\n                        commitStamp();\n                    }\n                });\n\n                // Commit on tool change\n                container.find('.wb-tool').click(function () {\n                    commitText();\n                    commitStamp();\n                });\n\n                // --- Eyedropper Feedback ---\n                $(board.canvas).on('wb:colorpicked', function (e, hex) {\n                    board.strokeColor = hex;\n                    container.find('.wb-stroke-color').css('background-color', hex);\n                    container.find('.wb-stroke-picker').val(hex);\n                    // Switch back to pencil after picking\n                    container.find('[data-tool=\"pencil\"]').click();\n                });\n\n                // --- Auto-Save and Manual Save Handling ---\n                var saveTimer = null;\n                var performSave = function () {\n                    var btn = container.find('.save-whiteboard');\n                    // If button is already disabled (saving in progress), skip.\n                    if (btn.prop('disabled')) {\n                        return;\n                    }\n\n                    var vectorData = board.getVectorData();\n                    var imageData = board.getImageData();\n\n                    var vectorControl = $('#' + container.data('vectorcontrol'));\n                    var updateControl = $('#' + container.data('updatecontrol'));\n                    var draftitemid = container.data('draftitemid');\n\n                    btn.text(self.strings.saving).prop('disabled', true);\n\n                    Ajax.call([{\n                        methodname: 'assignsubmission_cloudpoodll_upload_whiteboard_image',\n                        args: {\n                            base64data: imageData,\n                            draftitemid: draftitemid,\n                            filename: 'img' + draftitemid + '.jpg'\n                        }\n                    }])[0].then(function (filename) {\n                        vectorControl.val(vectorData);\n                        updateControl.val(filename);\n                        btn.text(self.strings.saved);\n                        // Trigger change on update control to notify Moodle form.\n                        updateControl.trigger('change');\n                        return filename;\n                    }).catch(function (e) {\n                        btn.text(self.strings.save).prop('disabled', false);\n                        Notification.exception(e);\n                    });\n                };\n\n                container.find('.save-whiteboard').click(function () {\n                    if (saveTimer) {\n                        clearTimeout(saveTimer);\n                    }\n                    performSave();\n                });\n\n                $(board.canvas).on('wb:changed', function () {\n                    var btn = container.find('.save-whiteboard');\n                    btn.text(self.strings.save).prop('disabled', false);\n\n                    if (saveTimer) {\n                        clearTimeout(saveTimer);\n                    }\n                    saveTimer = setTimeout(function () {\n                        performSave();\n                    }, 1000);\n                });\n\n                // --- Load Existing Data ---\n                var vectorControlId = container.data('vectorcontrol');\n                if (vectorControlId) {\n                    var existingJson = $('#' + vectorControlId).val();\n                    if (existingJson) {\n                        board.loadVectorData(existingJson);\n                    }\n                }\n            }\n        };\n    });\n"],"names":["define","$","log","Ajax","Notification","Str","DrawingBoard","strings","init","uniqueid","container","board","setup_strings","setup_controls","self","this","get_strings","done","s","i","save","saving","saved","confirmclearcanvas","enterthetext","backimage","data","setBackImage","vdata","setVectorData","find","click","tool","removeClass","addClass","hide","show","css","size","strokeSize","stampPaths","activeStamp","$activeStampBox","updateStampSVG","siblings","strokeColor","fillColor","bgColor","redraw","on","color","val","toggleClass","undo","redo","confirm","clear","baseWidth","baseHeight","canvas","e","dims","width","height","updateZoom","zoom","$activeTextBox","commitText","text","trim","pos","position","step","type","points","x","left","y","top","Math","max","fontFamily","fontSize","parseInt","isBold","is","isItalic","addStep","remove","commitStamp","stamp","paths","attr","setTimeout","rect","getBoundingClientRect","touch","originalEvent","touches","clientX","clientY","isInside","right","bottom","hasClass","$overlay","$textarea","updateStyles","off","append","dragStartX","dragStartY","initialLeft","initialTop","isDragging","pageX","pageY","stopPropagation","document","dx","dy","newLeft","newTop","maxLeft","outerWidth","maxTop","outerHeight","min","focus","createTextBox","$svg","$resizeHandle","initialWidth","isResizing","target","preventDefault","newSize","createStampBox","hex","saveTimer","performSave","btn","prop","vectorData","getVectorData","imageData","getImageData","vectorControl","updateControl","draftitemid","call","methodname","args","base64data","filename","then","trigger","catch","exception","clearTimeout","vectorControlId","existingJson","loadVectorData"],"mappings":"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"}