{"version":3,"file":"whiteboard.min.js","sources":["../src/whiteboard.js"],"sourcesContent":["define(['jquery', 'core/log', 'core/ajax', 'core/notification', 'core/str', 'assignsubmission_cloudpoodll/drawing_board'],\n    function ($, log, Ajax, Notification, Str, DrawingBoard) {\n        \"use strict\";\n\n        return {\n\n            strings: {},\n\n            init: function (uniqueid) {\n                var container = $('#' + uniqueid);\n                var canvasid = uniqueid + '_canvas';\n                var board = new DrawingBoard(canvasid);\n                this.setup_strings(container);\n                this.setup_controls(container, board);\n            },\n\n            setup_strings: function () {\n                var self = this;\n                // Set up strings\n                Str.get_strings([\n                    { \"key\": \"save\", \"component\": \"assignsubmission_cloudpoodll\" },\n                    { \"key\": \"saving\", \"component\": \"assignsubmission_cloudpoodll\" },\n                    { \"key\": \"saved\", \"component\": \"assignsubmission_cloudpoodll\" },\n                    { \"key\": \"confirmclearcanvas\", \"component\": \"assignsubmission_cloudpoodll\" },\n                    { \"key\": \"enterthetext\", \"component\": \"assignsubmission_cloudpoodll\" },\n                ]).done(function (s) {\n                    var i = 0;\n                    self.strings.save = s[i++];\n                    self.strings.saving = s[i++];\n                    self.strings.saved = s[i++];\n                    self.strings.confirmclearcanvas = s[i++];\n                    self.strings.enterthetext = s[i++];\n                });\n            },\n\n            setup_controls: function (container, board) {\n                var self = this;\n\n                // Set background image if provided\n                var backimage = container.data('backimage');\n                if (backimage) {\n                    board.setBackImage(backimage);\n                }\n\n                // Set vector data if provided\n                var vdata = container.data('vdata');\n                if (vdata) {\n                    board.setVectorData(vdata);\n                }\n\n\n                // --- Tool Selection ---\n                container.find('.wb-tool').click(function () {\n                    var tool = $(this).data('tool');\n                    board.tool = tool;\n                    container.find('.wb-tool').removeClass('active');\n                    $(this).addClass('active');\n\n                    // Toggle top bar panels\n                    if (tool === 'text') {\n                        container.find('.wb-stroke-sizes').hide();\n                        container.find('.wb-text-settings').show();\n                    } else {\n                        container.find('.wb-text-settings').hide();\n                        container.find('.wb-stroke-sizes').show();\n                    }\n                });\n\n                // --- Stroke Size ---\n                container.find('.wb-size').click(function () {\n                    var size = $(this).data('size');\n                    board.strokeSize = size;\n                    container.find('.wb-size').removeClass('active');\n                    $(this).addClass('active');\n                });\n\n                // --- Color Pickers ---\n                container.find('.wb-color-box').click(function () {\n                    $(this).next('.wb-color-picker').click();\n                });\n\n                container.find('.wb-stroke-picker').on('input change', function () {\n                    var color = $(this).val();\n                    board.strokeColor = color;\n                    container.find('.wb-stroke-color').css('background-color', color);\n                });\n\n                container.find('.wb-fill-picker').on('input change', function () {\n                    var color = $(this).val();\n                    board.fillColor = color;\n                    container.find('.wb-fill-color').css('background-color', color);\n                });\n\n                container.find('.wb-bg-picker').on('input change', function () {\n                    var color = $(this).val();\n                    board.bgColor = color;\n                    container.find('.wb-bg-color').css('background-color', color);\n                    board.redraw();\n                });\n\n                // --- Sidebar Toggle ---\n                container.find('.wb-sidebar-toggle').click(function () {\n                    container.find('.wb-sidebar').toggleClass('collapsed');\n                });\n\n                // --- Actions ---\n                container.find('.undo-whiteboard').click(function () { board.undo(); });\n                container.find('.redo-whiteboard').click(function () { board.redo(); });\n                container.find('.clear-whiteboard').click(function () {\n                    if (confirm(self.strings.confirmclearcanvas)) {\n                        board.clear();\n                    }\n                });\n\n                var baseWidth = container.data('width') || 800;\n                var baseHeight = container.data('height') || 600;\n\n                $(board.canvas).on('wb:resized', function (e, dims) {\n                    baseWidth = dims.width;\n                    baseHeight = dims.height;\n                    updateZoom();\n                });\n\n                var updateZoom = function () {\n                    var $canvas = $(board.canvas);\n                    $canvas.css({\n                        'transform': 'scale(' + board.zoom + ')',\n                        'transform-origin': '0 0'\n                    });\n                    var $wb = container.find('.assignsubmission_cloudpoodll_whiteboard');\n                    $wb.css({\n                        'width': (baseWidth * board.zoom) + 'px',\n                        'height': (baseHeight * board.zoom) + 'px'\n                    });\n                };\n\n                container.find('.zoom-in').click(function () {\n                    board.zoom += 0.1;\n                    updateZoom();\n                });\n                container.find('.zoom-out').click(function () {\n                    if (board.zoom > 0.5) {\n                        board.zoom -= 0.1;\n                        updateZoom();\n                    }\n                });\n\n                // --- Interactive Text Tool ---\n                var $activeTextBox = null;\n\n                var commitText = function () {\n                    if (!$activeTextBox) return;\n                    var $textarea = $activeTextBox.find('textarea');\n                    var text = $textarea.val();\n                    if (text.trim() !== '') {\n                        var pos = $activeTextBox.position();\n                        // Adjust position based on zoom\n                        var x = pos.left / board.zoom;\n                        var y = pos.top / board.zoom;\n\n                        var step = {\n                            type: 'text',\n                            text: text,\n                            points: [{ x: x, y: y }],\n                            width: Math.max(10, ($activeTextBox.width() - 8) / board.zoom), // -8px for padding match\n                            strokeColor: board.strokeColor,\n                            fillColor: board.fillColor,\n                            strokeSize: board.strokeSize,\n                            fontFamily: container.find('.wb-text-font').val(),\n                            fontSize: parseInt(container.find('.wb-text-size').val()),\n                            isBold: container.find('.wb-text-bold').is(':checked'),\n                            isItalic: container.find('.wb-text-italic').is(':checked')\n                        };\n                        board.addStep(step);\n                        board.redraw();\n                    }\n                    $activeTextBox.remove();\n                    $activeTextBox = null;\n                };\n\n                var createTextBox = function (x, y) {\n                    commitText(); // Commit any existing one\n\n                    var $overlay = $('<div class=\"wb-text-overlay editing\"></div>');\n                    var $textarea = $('<textarea spellcheck=\"false\"></textarea>');\n\n                    // Apply current styles\n                    var updateStyles = function () {\n                        var fontFamily = container.find('.wb-text-font').val();\n                        var fontSize = container.find('.wb-text-size').val() + 'px';\n                        var isBold = container.find('.wb-text-bold').is(':checked');\n                        var isItalic = container.find('.wb-text-italic').is(':checked');\n\n                        $textarea.css({\n                            'font-family': fontFamily,\n                            'font-size': fontSize,\n                            'font-weight': isBold ? 'bold' : 'normal',\n                            'font-style': isItalic ? 'italic' : 'normal',\n                            'color': board.strokeColor\n                        });\n                    };\n\n                    updateStyles();\n\n                    // Listeners for live styling updates\n                    container.find('.wb-text-settings input, .wb-text-settings select, .wb-stroke-picker').off('change.wblive').on('change.wblive', updateStyles);\n\n                    $overlay.append($textarea);\n\n                    // Position it taking zoom into account\n                    $overlay.css({\n                        left: x * board.zoom,\n                        top: y * board.zoom\n                    });\n\n                    // Interaction logic\n                    var isDragging = false;\n                    var dragStartX, dragStartY, initialLeft, initialTop;\n\n                    $overlay.on('mousedown touchstart', function (e) {\n                        if ($overlay.hasClass('selected')) {\n                            isDragging = true;\n                            var touch = e.originalEvent.touches ? e.originalEvent.touches[0] : e;\n                            dragStartX = touch.pageX;\n                            dragStartY = touch.pageY;\n                            var pos = $overlay.position();\n                            initialLeft = pos.left;\n                            initialTop = pos.top;\n                            e.stopPropagation(); // Prevent board from drawing\n                        }\n                    });\n\n                    $(document).on('mousemove.wbtextdrag touchmove.wbtextdrag', function (e) {\n                        if (isDragging) {\n                            var touch = e.originalEvent.touches ? e.originalEvent.touches[0] : e;\n                            var dx = touch.pageX - dragStartX;\n                            var dy = touch.pageY - dragStartY;\n                            var newLeft = initialLeft + dx;\n                            var newTop = initialTop + dy;\n\n                            // Constrain to canvas\n                            var maxLeft = board.canvas.width * board.zoom - $overlay.outerWidth();\n                            var maxTop = board.canvas.height * board.zoom - $overlay.outerHeight();\n\n                            newLeft = Math.max(0, Math.min(newLeft, maxLeft));\n                            newTop = Math.max(0, Math.min(newTop, maxTop));\n\n                            $overlay.css({\n                                left: newLeft,\n                                top: newTop\n                            });\n                        }\n                    });\n\n                    $(document).on('mouseup.wbtextdrag touchend.wbtextdrag', function (e) {\n                        isDragging = false;\n                    });\n\n                    // Switch to selected mode on blur\n                    $textarea.on('blur', function () {\n                        $overlay.removeClass('editing').addClass('selected');\n                    });\n\n                    // Switch back to editing on double click or if it's selected and clicked\n                    $overlay.on('click', function (e) {\n                        if ($overlay.hasClass('selected')) {\n                            $overlay.removeClass('selected').addClass('editing');\n                            $textarea.focus();\n                            e.stopPropagation();\n                        }\n                    });\n\n                    container.find('.assignsubmission_cloudpoodll_whiteboard').append($overlay);\n                    $textarea.focus();\n                    $activeTextBox = $overlay;\n                };\n\n                $(board.canvas).on('mousedown touchstart', function (e) {\n                    if (board.tool === 'text') {\n                        if ($activeTextBox && $activeTextBox.hasClass('selected')) {\n                            commitText();\n                        } else if (!$activeTextBox) {\n                            var rect = board.canvas.getBoundingClientRect();\n                            var touch = e.originalEvent.touches ? e.originalEvent.touches[0] : e;\n                            var clientX = touch.clientX;\n                            var clientY = touch.clientY;\n\n                            // Only create if click is inside the actual canvas bounds\n                            if (clientX >= rect.left && clientX <= rect.right &&\n                                clientY >= rect.top && clientY <= rect.bottom) {\n                                var x = (clientX - rect.left) / board.zoom;\n                                var y = (clientY - rect.top) / board.zoom;\n                                createTextBox(x, y);\n                            }\n                        }\n                    } else {\n                        commitText(); // Clicked with another tool, commit text\n                    }\n                });\n\n                // Commit on tool change\n                container.find('.wb-tool').click(function () {\n                    commitText();\n                });\n\n                // --- Eyedropper Feedback ---\n                $(board.canvas).on('wb:colorpicked', function (e, hex) {\n                    board.strokeColor = hex;\n                    container.find('.wb-stroke-color').css('background-color', hex);\n                    container.find('.wb-stroke-picker').val(hex);\n                    // Switch back to pencil after picking\n                    container.find('[data-tool=\"pencil\"]').click();\n                });\n\n                // --- Auto-Save and Manual Save Handling ---\n                var saveTimer = null;\n                var performSave = function () {\n                    var btn = container.find('.save-whiteboard');\n                    // If button is already disabled (saving in progress), skip.\n                    if (btn.prop('disabled')) {\n                        return;\n                    }\n\n                    var vectorData = board.getVectorData();\n                    var imageData = board.getImageData();\n\n                    var vectorControl = $('#' + container.data('vectorcontrol'));\n                    var updateControl = $('#' + container.data('updatecontrol'));\n                    var draftitemid = container.data('draftitemid');\n\n                    btn.text(self.strings.saving).prop('disabled', true);\n\n                    Ajax.call([{\n                        methodname: 'assignsubmission_cloudpoodll_upload_whiteboard_image',\n                        args: {\n                            base64data: imageData,\n                            draftitemid: draftitemid,\n                            filename: 'img' + draftitemid + '.jpg'\n                        }\n                    }])[0].then(function (filename) {\n                        vectorControl.val(vectorData);\n                        updateControl.val(filename);\n                        btn.text(self.strings.saved);\n                        // Trigger change on update control to notify Moodle form.\n                        updateControl.trigger('change');\n                        return filename;\n                    }).catch(function (e) {\n                        btn.text(self.strings.save).prop('disabled', false);\n                        Notification.exception(e);\n                    });\n                };\n\n                container.find('.save-whiteboard').click(function () {\n                    if (saveTimer) {\n                        clearTimeout(saveTimer);\n                    }\n                    performSave();\n                });\n\n                $(board.canvas).on('wb:changed', function () {\n                    var btn = container.find('.save-whiteboard');\n                    btn.text(self.strings.save).prop('disabled', false);\n\n                    if (saveTimer) {\n                        clearTimeout(saveTimer);\n                    }\n                    saveTimer = setTimeout(function () {\n                        performSave();\n                    }, 1000);\n                });\n\n                // --- Load Existing Data ---\n                var vectorControlId = container.data('vectorcontrol');\n                if (vectorControlId) {\n                    var existingJson = $('#' + vectorControlId).val();\n                    if (existingJson) {\n                        board.loadVectorData(existingJson);\n                    }\n                }\n            }\n        };\n    });\n"],"names":["define","$","log","Ajax","Notification","Str","DrawingBoard","strings","init","uniqueid","container","board","setup_strings","setup_controls","self","this","get_strings","done","s","i","save","saving","saved","confirmclearcanvas","enterthetext","backimage","data","setBackImage","vdata","setVectorData","find","click","tool","removeClass","addClass","hide","show","size","strokeSize","next","on","color","val","strokeColor","css","fillColor","bgColor","redraw","toggleClass","undo","redo","confirm","clear","baseWidth","baseHeight","canvas","e","dims","width","height","updateZoom","zoom","$activeTextBox","commitText","text","trim","pos","position","step","type","points","x","left","y","top","Math","max","fontFamily","fontSize","parseInt","isBold","is","isItalic","addStep","remove","hasClass","rect","getBoundingClientRect","touch","originalEvent","touches","clientX","clientY","right","bottom","$overlay","$textarea","updateStyles","off","append","dragStartX","dragStartY","initialLeft","initialTop","isDragging","pageX","pageY","stopPropagation","document","dx","dy","newLeft","newTop","maxLeft","outerWidth","maxTop","outerHeight","min","focus","createTextBox","hex","saveTimer","performSave","btn","prop","vectorData","getVectorData","imageData","getImageData","vectorControl","updateControl","draftitemid","call","methodname","args","base64data","filename","then","trigger","catch","exception","clearTimeout","setTimeout","vectorControlId","existingJson","loadVectorData"],"mappings":"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"}